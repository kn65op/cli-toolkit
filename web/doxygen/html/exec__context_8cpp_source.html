<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CLI: exec_context.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20981143-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>exec_context.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2013, Alexis Royer, http://alexis.royer.free.fr/CLI</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation</span>
<a name="l00010"></a>00010 <span class="comment">          and/or other materials provided with the distribution.</span>
<a name="l00011"></a>00011 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software</span>
<a name="l00012"></a>00012 <span class="comment">          without specific prior written permission.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00015"></a>00015 <span class="comment">    &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00016"></a>00016 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00017"></a>00017 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00018"></a>00018 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00019"></a>00019 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00020"></a>00020 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00021"></a>00021 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00022"></a>00022 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00023"></a>00023 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00024"></a>00024 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00025"></a>00025 <span class="comment">*/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="pch_8h.html" title="CLI library default pre-compiled header.">cli/pch.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="exec__context_8h.html" title="Execution context class definition.">cli/exec_context.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="non__blocking__io__device_8h.html" title="NonBlockingDevice class definition.">cli/non_blocking_io_device.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="traces_8h.html" title="Traces management system definition.">cli/traces.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="exec__context__manager_8h.html" title="Execution context manager class definition.">exec_context_manager.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="constraints_8h.html" title="Object consistency insurance.">constraints.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <a class="code" href="namespace_8h.html#a965caf70ca576c007bee150001248651" title="Using namespace directive.">CLI_NS_USE</a>(cli)
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">// ExecutionContext implementation.</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <a class="code" href="classExecutionContext.html" title="Execution context.">ExecutionContext</a>::<a class="code" href="classExecutionContext.html" title="Execution context.">ExecutionContext</a>(<span class="keywordtype">void</span>)
<a name="l00043"></a>00043   : m_cliManager(* new <a class="code" href="classExecutionContextManager.html" title="Execution context manager class.">ExecutionContextManager</a>()), <span class="comment">// Auto-deleted on FreeInstance().</span>
<a name="l00044"></a>00044     m_tkResults(MAX_EXECUTION_CONTEXTS)
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: New top execution context.&quot;</span> &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a" title="The common IOEndl object.">endl</a>;
<a name="l00047"></a>00047     m_cliManager.UseInstance(*<span class="keyword">this</span>);
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <a class="code" href="classExecutionContext.html#a75325bb8d7d4648ffee6c3d3b996b1f7" title="Top context constructor.">ExecutionContext::ExecutionContext</a>(<a class="code" href="classExecutionContext.html" title="Execution context.">ExecutionContext</a>&amp; CLI_ParentContext)
<a name="l00051"></a>00051   : m_cliManager(CLI_ParentContext.m_cliManager),
<a name="l00052"></a>00052     m_tkResults(MAX_EXECUTION_CONTEXTS)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: New child execution context.&quot;</span> &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a" title="The common IOEndl object.">endl</a>;
<a name="l00055"></a>00055     m_cliManager.UseInstance(*<span class="keyword">this</span>);
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <a class="code" href="classExecutionContext.html#a436ba634e4738b07592edc597b351b18" title="Destructor.">ExecutionContext::~ExecutionContext</a>(<span class="keywordtype">void</span>)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: End of execution context.&quot;</span> &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a" title="The common IOEndl object.">endl</a>;
<a name="l00061"></a>00061     m_cliManager.<a class="code" href="classExecutionContextManager.html#a07dba55f33ca7639e3ac30e7d482bbfe" title="Instance deregistration.">FreeInstance</a>(*<span class="keyword">this</span>);
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 ExecutionContextManager&amp; <a class="code" href="classExecutionContext.html#a48a63c7f93d403352175744d5cedab2d" title="Execution context manager accessor.">ExecutionContext::GetContextManager</a>(<span class="keywordtype">void</span>)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     <span class="keywordflow">return</span> m_cliManager;
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">const</span> <a class="code" href="classIODevice.html" title="Generic input/output device.">IODevice</a>&amp; <a class="code" href="classExecutionContext.html#add8486199a73f2bb56830ed003dcb321" title="Input stream accessor.">ExecutionContext::GetInput</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00070"></a>00070 <span class="keyword"></span>{
<a name="l00071"></a>00071     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#a2e14c92f348bf7f7ad9a8e8f904a777b" title="Input stream accessor.">GetInput</a>();
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keyword">const</span> <a class="code" href="classOutputDevice.html" title="Generic output device.">OutputDevice</a>&amp; <a class="code" href="classExecutionContext.html#a6fd7a732424cb3fd253079bbf704ebef" title="Output stream accessor.">ExecutionContext::GetStream</a>(<span class="keyword">const</span> <a class="code" href="exec__context_8h.html#a8777d6765665b0c44a1caa09dc335fe3" title="Output stream enumeration.">STREAM_TYPE</a> E_StreamType)<span class="keyword"> const</span>
<a name="l00075"></a>00075 <span class="keyword"></span>{
<a name="l00076"></a>00076     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#a57ba62bc80980889b37a465d64b13bfc" title="Output stream accessor.">GetStream</a>(E_StreamType);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classExecutionContext.html#aaf750f141101e90f2c78cb35fe825605" title="Output stream positionning.">ExecutionContext::SetStream</a>(<span class="keyword">const</span> <a class="code" href="exec__context_8h.html#a8777d6765665b0c44a1caa09dc335fe3" title="Output stream enumeration.">STREAM_TYPE</a> E_StreamType, <a class="code" href="classOutputDevice.html" title="Generic output device.">OutputDevice</a>&amp; CLI_Stream)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#ab3cf6794c00714a69b13d695e08b5d3a" title="Output stream positionning.">SetStream</a>(E_StreamType, CLI_Stream);
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classExecutionContext.html#a5cd3152dd5d07393cb4ff775f8c337cb" title="Enabled/disabled stream accessor.">ExecutionContext::StreamEnabled</a>(<span class="keyword">const</span> <a class="code" href="exec__context_8h.html#a8777d6765665b0c44a1caa09dc335fe3" title="Output stream enumeration.">STREAM_TYPE</a> E_StreamType)<span class="keyword"> const</span>
<a name="l00085"></a>00085 <span class="keyword"></span>{
<a name="l00086"></a>00086     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#af3ceb5f319d3a9f529dbd9776aa04c2b" title="Enabled/disabled stream accessor.">StreamEnabled</a>(E_StreamType);
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classExecutionContext.html#aef973dee56940366895986e63f276f81" title="Enable/disable stream.">ExecutionContext::EnableStream</a>(<span class="keyword">const</span> <a class="code" href="exec__context_8h.html#a8777d6765665b0c44a1caa09dc335fe3" title="Output stream enumeration.">STREAM_TYPE</a> E_StreamType, <span class="keyword">const</span> <span class="keywordtype">bool</span> B_Enable)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#ad732e095ead961dcb43727bfa03b1bcc" title="Enable/disable stream.">EnableStream</a>(E_StreamType, B_Enable);
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#a3af7157b8ee0980415614fe68a84fe5c" title="Language setting.">ExecutionContext::SetLang</a>(<span class="keyword">const</span> <a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3" title="Languages identifiers.">ResourceString::LANG</a> E_Lang)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096     m_cliManager.<a class="code" href="classExecutionContextManager.html#ad69cf0610371efd2a0315e6fdc4fe38f" title="Language setting.">SetLang</a>(E_Lang);
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="keyword">const</span> <a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3" title="Languages identifiers.">ResourceString::LANG</a> <a class="code" href="classExecutionContext.html#a17c4b76a71977d05f72b6e8b54dfb5a1" title="Language access.">ExecutionContext::GetLang</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00100"></a>00100 <span class="keyword"></span>{
<a name="l00101"></a>00101     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#a7f2e5dcce91dc6e3cb753b9c3b635e53" title="Language access.">GetLang</a>();
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#a254d057dcc0dfe1a2373bdb2b9e0bb2f" title="Beep configuration setting.">ExecutionContext::SetBeep</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> B_Enable)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106     m_cliManager.<a class="code" href="classExecutionContextManager.html#abcdbf5d9106b3eb06a46337606f9df24" title="Beep configuration setting.">SetBeep</a>(B_Enable);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classExecutionContext.html#af30a9621e3b3aaf3a4c11d2283697a38" title="Beep configuration access.">ExecutionContext::GetBeep</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00110"></a>00110 <span class="keyword"></span>{
<a name="l00111"></a>00111     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#a4946975ed949ad9f01ecf5eef22570ab" title="Beep configuration access.">GetBeep</a>();
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#a64ad190dcdb2bf789d5e45f454304f8e" title="Sends a beep signal.">ExecutionContext::Beep</a>(<span class="keywordtype">void</span>)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116     m_cliManager.<a class="code" href="classExecutionContextManager.html#a82edbb5e866d0308e219d3c37333d752" title="Sends a beep signal.">Beep</a>();
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#af8cbb3863e9e9820972f4d98fb8ce99b" title="Runs the execution context as a child context of the parent given by the construction.">ExecutionContext::Run</a>(<a class="code" href="classIODevice.html" title="Generic input/output device.">IODevice</a>&amp; CLI_IODevice)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (BeginExecution(CLI_IODevice))
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         <span class="keywordflow">if</span> (dynamic_cast&lt;NonBlockingIODevice*&gt;(&amp; CLI_IODevice) == NULL)
<a name="l00124"></a>00124         {
<a name="l00125"></a>00125             <span class="comment">// Call the main blocking loop.</span>
<a name="l00126"></a>00126             MainBlockingLoop();
<a name="l00127"></a>00127             <span class="comment">// Once the main loop is done, terminate the thing.</span>
<a name="l00128"></a>00128             FinishExecution();
<a name="l00129"></a>00129         }
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     <span class="keywordflow">else</span>
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         FinishExecution();
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#af8cbb3863e9e9820972f4d98fb8ce99b" title="Runs the execution context as a child context of the parent given by the construction.">ExecutionContext::Run</a>(<span class="keywordtype">void</span>)
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139     <a class="code" href="classExecutionContext.html#af8cbb3863e9e9820972f4d98fb8ce99b" title="Runs the execution context as a child context of the parent given by the construction.">Run</a>(const_cast&lt;IODevice&amp;&gt;(<a class="code" href="classExecutionContext.html#add8486199a73f2bb56830ed003dcb321" title="Input stream accessor.">GetInput</a>()));
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keyword">const</span> <span class="keywordtype">bool</span> ExecutionContext::BeginExecution(<a class="code" href="classIODevice.html" title="Generic input/output device.">IODevice</a>&amp; CLI_IODevice)
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: Starting execution.&quot;</span> &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a" title="The common IOEndl object.">endl</a>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (m_cliManager.<a class="code" href="classExecutionContextManager.html#ab00bb21fc2e3a825d30126e8e2abf14a" title="Assumes input and output devices to be ready for execution.">OpenUp</a>(*<span class="keyword">this</span>, CLI_IODevice))
<a name="l00147"></a>00147     {
<a name="l00148"></a>00148         <span class="comment">// Let the actual execution context make its own start ups.</span>
<a name="l00149"></a>00149         <span class="keywordflow">if</span> (<a class="code" href="classExecutionContext.html#a4acb24ba9c185623407de4952f008765" title="Beginning of execution handler.">OnStartExecution</a>())
<a name="l00150"></a>00150         {
<a name="l00151"></a>00151             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="keywordtype">void</span> ExecutionContext::MainBlockingLoop(<span class="keywordtype">void</span>)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <span class="comment">// While there are menus in the menu stack, it means we are still waiting for command lines.</span>
<a name="l00161"></a>00161     <span class="keywordflow">while</span> (<a class="code" href="classExecutionContext.html#a3341e077576d1875b08dd65a3f22a019" title="Tells whether this execution context is running or not.">IsRunning</a>())
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         <span class="comment">// Get an input key.</span>
<a name="l00164"></a>00164         <span class="keyword">const</span> <a class="code" href="io__device_8h.html#a90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> e_Key = m_cliManager.<a class="code" href="classExecutionContextManager.html#a2e14c92f348bf7f7ad9a8e8f904a777b" title="Input stream accessor.">GetInput</a>().<a class="code" href="classIODevice.html#a7bafac5c500746f742aa289f33e38feb" title="Input key capture handler.">GetKey</a>();
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (e_Key != <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>)
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167             <span class="comment">// Process the input key.</span>
<a name="l00168"></a>00168             ProcessKey(e_Key);
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         <span class="keywordflow">else</span>
<a name="l00171"></a>00171         {
<a name="l00172"></a>00172             <span class="comment">// End of input.</span>
<a name="l00173"></a>00173             FinishExecution();
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="keywordtype">void</span> ExecutionContext::ProcessKey(<span class="keyword">const</span> <a class="code" href="io__device_8h.html#a90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> E_KeyCode)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="keyword">const</span> <a class="code" href="classOutputDevice.html" title="Generic output device.">OutputDevice</a>&amp; cli_Trace = <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;
<a name="l00181"></a>00181     <span class="keywordflow">switch</span> (E_KeyCode)
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183     <span class="keywordflow">case</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a951ab68bb8f7daafb78951107080904e" title="Enter.">ENTER</a>: cli_Trace &lt;&lt; <span class="stringliteral">&quot;Key &quot;</span> &lt;&lt; E_KeyCode &lt;&lt; <span class="stringliteral">&quot;/\\n&quot;</span>; <span class="keywordflow">break</span>;
<a name="l00184"></a>00184     <span class="keywordflow">default</span>:    cli_Trace &lt;&lt; <span class="stringliteral">&quot;Key &quot;</span> &lt;&lt; E_KeyCode &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; (char) E_KeyCode; <span class="keywordflow">break</span>;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     cli_Trace &lt;&lt; <span class="stringliteral">&quot; received.&quot;</span> &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a" title="The common IOEndl object.">endl</a>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (<a class="code" href="classExecutionContext.html#a3341e077576d1875b08dd65a3f22a019" title="Tells whether this execution context is running or not.">IsRunning</a>())
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190         <span class="keywordflow">if</span> (E_KeyCode != <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>)
<a name="l00191"></a>00191         {
<a name="l00192"></a>00192             <span class="comment">// Process the input key.</span>
<a name="l00193"></a>00193             <a class="code" href="classExecutionContext.html#a995e9ad7eea6fa722e49cd212a9595ae" title="Handler called on character input.">OnKey</a>(E_KeyCode);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         <span class="keywordflow">else</span>
<a name="l00196"></a>00196         {
<a name="l00197"></a>00197             <span class="comment">// End of input.</span>
<a name="l00198"></a>00198             FinishExecution();
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <span class="keyword">const</span> <span class="keywordtype">bool</span> ExecutionContext::FinishExecution(<span class="keywordtype">void</span>)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: Ending execution.&quot;</span> &lt;&lt; endl;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="keywordtype">bool</span> b_Res = <span class="keyword">true</span>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     <span class="comment">// Let the actual execution context make its own liberations.</span>
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (! <a class="code" href="classExecutionContext.html#a081df995789688d8439ee035807db583" title="Execution termination handler.">OnStopExecution</a>())
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212         b_Res = <span class="keyword">false</span>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">// Do not terminate twice.</span>
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (<a class="code" href="classExecutionContext.html#a3341e077576d1875b08dd65a3f22a019" title="Tells whether this execution context is running or not.">IsRunning</a>())
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (! m_cliManager.<a class="code" href="classExecutionContextManager.html#aea40a46d7c312df896d210a237929efc" title="Release input and output devices after execution.">CloseDown</a>(*<span class="keyword">this</span>))
<a name="l00219"></a>00219         {
<a name="l00220"></a>00220             b_Res = <span class="keyword">false</span>;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="comment">// Call registered result interfaces at the very end.</span>
<a name="l00224"></a>00224         tk::Queue&lt;ExecutionResult*&gt; tk_Results(m_tkResults.GetCount());
<a name="l00225"></a>00225         <span class="keywordflow">while</span> (! m_tkResults.IsEmpty())
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227             tk_Results.AddTail(m_tkResults.RemoveHead());
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229         <span class="keywordflow">while</span> (! tk_Results.IsEmpty())
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (<a class="code" href="classExecutionResult.html" title="Result interface for execution contexts.">ExecutionResult</a>* <span class="keyword">const</span> pcli_ExecutionResult = tk_Results.RemoveTail())
<a name="l00232"></a>00232             {
<a name="l00233"></a>00233                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;: Notifying result to interface &quot;</span> &lt;&lt; pcli_ExecutionResult &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00234"></a>00234                 pcli_ExecutionResult-&gt;OnResult(*<span class="keyword">this</span>);
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="keywordflow">return</span> b_Res;
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classExecutionContext.html#a3341e077576d1875b08dd65a3f22a019" title="Tells whether this execution context is running or not.">ExecutionContext::IsRunning</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00243"></a>00243 <span class="keyword"></span>{
<a name="l00244"></a>00244     <span class="keywordflow">return</span> m_cliManager.<a class="code" href="classExecutionContextManager.html#a2701d8e65ae11f332a8618d20c355a99" title="Determines whether the execution context manager is currently running.">IsRunning</a>(*<span class="keyword">this</span>);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#a13cb9ac08f8e36d063fde2ef0cb02ea3" title="Terminates this execution context&amp;#39;s execution.">ExecutionContext::StopExecution</a>(<span class="keywordtype">void</span>)
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     FinishExecution();
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="keywordtype">void</span> <a class="code" href="classExecutionContext.html#aa80f8cecc4248969ca5a6fccc4678f70" title="Terminates execution for all execution contexts attached to the same top execution context...">ExecutionContext::StopAllExecutions</a>(<span class="keywordtype">void</span>)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254     m_cliManager.<a class="code" href="classExecutionContextManager.html#a80bb413b7bafba7f8ee82453171e3774" title="Stop execution of all running contexts.">StopAllExecutions</a>();
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="comment">// ExecutionResult implementation.</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <a class="code" href="classExecutionResult.html#adfc70acc8385785f9f065457b4e43b8e" title="Default constructor.">ExecutionResult::ExecutionResult</a>(<span class="keywordtype">void</span>)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <a class="code" href="classExecutionResult.html#a9b3c99952d5601c102980a4353eac0b7" title="Pure virtual destructor.">ExecutionResult::~ExecutionResult</a>(<span class="keywordtype">void</span>)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="keywordtype">void</span> <a class="code" href="classExecutionResult.html#ad429b0545cea5fbbfd12ccafeb76a04c" title="Start watching the execution context for a result.">ExecutionResult::WatchResult</a>(<a class="code" href="classExecutionContext.html" title="Execution context.">ExecutionContext</a>&amp; CLI_Context)
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; &amp; CLI_Context &lt;&lt; <span class="stringliteral">&quot;: Registering result interface &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (! CLI_Context.m_tkResults.AddTail(<span class="keyword">this</span>))
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="exec__context__manager_8h.html#aac790929e4916f6ce0a388649b59eaa0" title="Execution context trace class singleton redirection.">TRACE_EXEC_CTX</a>) &lt;&lt; <span class="stringliteral">&quot;Execution context &quot;</span> &lt;&lt; &amp; CLI_Context &lt;&lt; <span class="stringliteral">&quot;: Could not register result interface &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Jul 24 2013 08:23:21 for CLI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
